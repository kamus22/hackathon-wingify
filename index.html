<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Knowledge Base Workflow</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <div class="container" id="main-app">
        
        <div id="login-screen">
            <h1>Knowledge Base Workflow Login</h1>
            <p>Please log in to access the Article Checker or Review Panel.</p>
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="user or admin">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="user or admin">
            <button onclick="loginUser()">Login</button>
            <p id="login-error" class="error"></p>
        </div>

        <div id="checker-view" style="display:none;">
            <h2>Knowledge Base Article Status Checker ğŸ“°</h2>
            <p>Welcome, <span id="current-username"></span>. Check VWO articles for outdated content and build export lists.</p>
            <button class="logout-btn" onclick="logoutUser()">Logout</button>
            
            <!-- VWO Article URL Checker Section -->
            <div class="vwo-checker-section">
                <h3>ğŸ” Check VWO Help Article by URL</h3>
                <p>Paste a VWO help article URL to check if it's been updated in the last year:</p>
                <div class="url-input-container">
                    <input type="text" id="vwo-article-url" placeholder="https://help.vwo.com/hc/en-us/articles/..." />
                    <button onclick="checkVWOArticle()" id="check-vwo-btn">Check Article</button>
                </div>
                <div id="vwo-result" class="vwo-result"></div>
            </div>

            <hr style="margin: 30px 0;">

            <!-- Export List Section -->
            <div class="export-list-section">
                <h3>ğŸ“‹ Export List (<span id="export-count">0</span> articles)</h3>
                <div class="export-actions">
                    <button onclick="exportListToPDF()" id="export-pdf-btn" disabled>ğŸ“„ Export to PDF</button>
                    <button onclick="clearExportList()" id="clear-list-btn" disabled>ğŸ—‘ï¸ Clear List</button>
                </div>
                <div id="export-list-container">
                    <p class="info">No articles in export list. Check outdated VWO articles above to start building your list.</p>
                </div>
            </div>
        </div>

        <div id="reviewer-view" style="display:none;">
            <h2>Admin Panel</h2>
            <p>Welcome, <span id="current-admin"></span>. Review drafts and consolidate PDF lists.</p>
            <button class="logout-btn" onclick="logoutUser()">Logout</button>

            <!-- Tabs for Admin -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="switchTab('reviews')">ğŸ“ Review Drafts</button>
                <button class="tab-btn" onclick="switchTab('consolidate')">ğŸ“Š Consolidate PDFs</button>
            </div>

            <!-- Review Drafts Tab -->
            <div id="reviews-tab" class="tab-content">
                <h3>Pending Draft Reviews</h3>
                <div id="pending-drafts">
                    <p class="info">No pending drafts for review.</p>
                </div>
            </div>

            <!-- Consolidate PDFs Tab -->
            <div id="consolidate-tab" class="tab-content" style="display:none;">
                <h3>Consolidate User PDF Lists</h3>
                <p>Upload multiple PDF export lists from users. The system will consolidate them and prioritize articles that appear in multiple lists.</p>
                
                <div class="pdf-upload-section">
                    <input type="file" id="pdf-upload" accept="application/pdf" multiple />
                    <button onclick="uploadPDFs()">ğŸ“¤ Upload PDFs</button>
                </div>

                <div id="uploaded-pdfs-list">
                    <h4>Uploaded PDFs (<span id="pdf-count">0</span>)</h4>
                    <div id="pdf-files-container"></div>
                </div>

                <button onclick="consolidatePDFs()" id="consolidate-btn" disabled>ğŸ”— Consolidate & Generate Report</button>
                
                <div id="consolidation-result"></div>
            </div>
            
            <!-- Draft Review Modal -->
            <div id="draft-modal" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-button" onclick="closeModal()">&times;</span>
                    <h3>Review Draft: <span id="draft-title"></span></h3>
                    <p>Submitted by: <span id="draft-submitter"></span></p>
                    <p>Original Article Date: <span id="draft-original-date"></span></p>
                    
                    <h4>Proposed Content:</h4>
                    <textarea id="draft-review-content" rows="10" readonly></textarea>
                    
                    <button class="approve" onclick="reviewAction('approve')">âœ… Approve Draft</button>
                    <button class="reject" onclick="reviewAction('reject')">âŒ Reject Draft</button>
                    <p id="review-status-message" class="info"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
